<!doctype html>
<html lang="ar" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Generate CV PDF</title>

<!-- خطوط (system + fallback) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">

<style>
  /* ---------- Style to match the uploaded PDF as closely as possible ---------- */
  :root {
    --accent: #0b63c6;
    --muted: #6b7280;
    --paper-w: 816px; /* ~A4 scaled */
  }

  body {
    background:#efefef;
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    padding:30px;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Container that will be converted to PDF */
  .cv-print {
    width: var(--paper-w);
    margin: 0 auto;
    background: #fff;
    color: #222;
    box-shadow: 0 6px 30px rgba(0,0,0,0.12);
    border-radius: 4px;
    overflow: hidden;
  }

  /* Header (name + contact) */
  .cv-header {
    padding: 28px 34px;
    display:flex;
    gap:18px;
    align-items:center;
    border-bottom: 1px solid #e6e6e6;
    background: linear-gradient(180deg, rgba(11,99,198,0.06), rgba(11,99,198,0.03));
  }
  .cv-photo {
    width:112px; height:112px; flex:0 0 112px;
    border-radius:6px;
    overflow:hidden;
    background:#ddd;
    display:flex;align-items:center;justify-content:center;
  }
  .cv-photo img { width:100%; height:100%; object-fit:cover; display:block; }

  .cv-head-meta { flex:1; }
  .cv-name {
    font-family: "Roboto Slab", serif;
    font-size:26px;
    margin:0 0 6px 0;
    color: var(--accent);
    font-weight:700;
  }
  .cv-role {
    margin:0 0 10px 0;
    font-size:14px;
    color:#111827;
    opacity:0.95;
  }
  .cv-contact {
    font-size:13px;
    color:var(--muted);
    line-height:1.6;
  }
  .cv-contact a { color:var(--muted); text-decoration:none; }

  /* two column layout */
  .cv-body {
    display:flex;
    gap:30px;
    padding:26px 34px 40px 34px;
  }

  /* LEFT column (summary / skills / misc) */
  .col-left {
    width: 32%;
    min-width: 240px;
  }

  .box {
    margin-bottom:18px;
  }
  .box-title {
    font-size:13px;
    color:var(--accent);
    font-weight:700;
    margin-bottom:10px;
    border-bottom:2px solid #eef6ff;
    padding-bottom:6px;
  }
  .summary-text {
    font-size:13px;
    color:#333;
    line-height:1.6;
  }

  /* skills as badge / list */
  .skills-grid { display:flex; flex-wrap:wrap; gap:8px; }
  .skill-badge {
    background:#f1f5fb;
    color:#0b63c6;
    padding:6px 8px;
    font-size:12px;
    border-radius:6px;
    border:1px solid #e6eefc;
  }

  .contact-list p { margin:6px 0; font-size:13px; color:var(--muted); }

  /* RIGHT column (experience / education) */
  .col-right { flex:1; }

  .exp-item {
    margin-bottom:14px;
  }
  .exp-title { font-size:15px; font-weight:700; color:#111827; margin:0 0 4px 0; }
  .exp-meta { font-size:12px; color:var(--muted); margin-bottom:6px; }
  .exp-desc { font-size:13px; color:#333; line-height:1.6; white-space:pre-wrap; }

  /* Projects / bullets small */
  .bullet { margin-left:0; padding-left:14px; text-indent:-8px; }
  .bullet li { margin:6px 0; font-size:13px; color:#333; }

  /* footer small note */
  .cv-footer {
    background:#fafafa;
    padding:10px 18px;
    font-size:12px;
    color:var(--muted);
    text-align:center;
    border-top:1px solid #eee;
  }

  /* small helper to reset fonts inside generated HTML (when injecting innerHTML) */
  .injected * { box-sizing:border-box; font-family:inherit; }

  /* make printed result look good on A4 when html2pdf captures it */
  @media print {
    body { background: white; padding:0; }
    .cv-print { box-shadow:none; margin:0; }
  }
</style>
</head>
<body dir="ltr">

<!-- ============== Note: your existing About/Skills/Resume sections should exist somewhere in the page.
     The script below will try to read from #about, #skills, #resume. ============== -->

<!-- For testing: Button to download -->
<div style="text-align:center; margin-bottom:18px;">
  <a href="#" id="downloadProfile" style="display:inline-block; padding:10px 18px; background:#0b63c6;color:white;border-radius:6px;text-decoration:none;">Download Profile</a>
</div>

<!-- Template (this will be filled and then converted to PDF) -->
<!-- Keep it hidden in page; html2pdf will render it -->
<div id="cv-output" style="display:none;"></div>

<!-- html2pdf library (stable) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
/*
  Script behaviour:
  - Read from #about, #skills, #resume
  - Fallback to values extracted from uploaded PDF (when element missing)
  - Build HTML that matches uploaded PDF layout
  - Use html2pdf to generate A4 pdf
*/

/* === Fallback data (from your uploaded PDF file if the page sections don't exist) ===
   (We include them so it works even if your page IDs are different.)
   Source: uploaded file. :contentReference[oaicite:1]{index=1}
*/
const FALLBACK = {
  name: "Ahmed Salah",
  role: "Full Stack Developer",
  location: "Saudi Arabia, Riyadh",
  phone: "+966 557703987",
  email: "a.salah@isit-sa.com",
  summary: "Full Stack Developer with 4+ years of experience building scalable web apps using PHP/Laravel, JavaScript, and REST APIs. Proven track record of delivering high-impact projects for recruitment, telecom, and enterprise clients. Passionate about clean code, performance optimization, and mentoring junior developers.",
  technical: [
    "Frontend: HTML5, CSS3, JavaScript (ES6+), jQuery, Bootstrap",
    "Backend: PHP, Laravel, Flask, RESTful APIs, MySQL",
    "DevOps/Tools: phpMyAdmin, Git, Postman, Docker (Basic)",
    "Networking: DHCP/DNS, Routing & Switching (CCNA-level)"
  ],
  experienceHTML: `
    <div class="exp-item">
      <div class="exp-title">CPTIT | Riyadh, KSA</div>
      <div class="exp-meta">Full Stack Developer — Dec 2024 – Feb 2025</div>
      <div class="exp-desc">Project: Whiteboard LMS
• Built a job portal with Laravel backend and Bootstrap frontend, reducing page load time by 40%.
• Developed a REST API for mobile app integration, enabling 10K+ monthly job applications.
• Designed MySQL database schemas for user profiles, job listings, and applications.
• Developed interactive virtual classroom with WebSockets, role-based dashboards, server-side caching and certificate automation.</div>
    </div>

    <div class="exp-item">
      <div class="exp-title">R Star | Egypt</div>
      <div class="exp-meta">Full Stack Developer — Dec 2023 – Sept 2024</div>
      <div class="exp-desc">Project: E-Commerce Platform — Created multi-vendor marketplace, integrated PayPal, optimized SQL queries.</div>
    </div>

    <div class="exp-item">
      <div class="exp-title">Telecom Egypt (WE) | Egypt</div>
      <div class="exp-meta">Networking & Web Developer — Jan 2021 – Jan 2022</div>
      <div class="exp-desc">Developed ISP customer dashboard and automated ticket resolution.</div>
    </div>
  `,
  educationHTML: `
    <div class="exp-item">
      <div class="exp-title">M.Sc. in Computer Science (2024 – Present)</div>
      <div class="exp-meta">Minia University — Thesis: “Optimizing Laravel APIs for Low-Latency Applications”</div>
    </div>
    <div class="exp-item">
      <div class="exp-title">B.Sc. in Computer Science (2016 – 2020)</div>
      <div class="exp-meta">Minia University — GPA: 3.6/4.0</div>
    </div>
  `,
  projectsHTML: `
    <div class="exp-item">
      <div class="exp-title">Personal Projects</div>
      <div class="exp-desc">Task Management App (Laravel + Vue.js) — Kanban-style app, Real-Time Chat API (Flask + WebSockets), Egyptian Food Delivery API (Laravel + MySQL).</div>
    </div>
  `,
  languagesHTML: `<p>Arabic (Native)</p><p>English (Professional)</p>`,
  photo: "" /* if page has profile image, will use it; fallback empty */
};

function getText(selector) {
  const el = document.querySelector(selector);
  return el ? el.innerText.trim() : "";
}
function getHTML(selector) {
  const el = document.querySelector(selector);
  return el ? el.innerHTML.trim() : "";
}
function getAttr(selector, attr) {
  const el = document.querySelector(selector);
  return el ? el.getAttribute(attr) : null;
}

document.getElementById("downloadProfile").addEventListener("click", function (ev) {
  ev.preventDefault();

  // read from page #about / #skills / #resume
  const name = getText("#about h2") || FALLBACK.name;
  // role: try to find a subtitle or the H2 second line
  let role = "";
  const aboutH2 = document.querySelector("#about h2");
  if (aboutH2) {
    // if H2 contains "Hi, I'm Abdulaziz – Recruitment & Manpower Specialist"
    role = aboutH2.innerText.split("–")[1] ? aboutH2.innerText.split("–")[1].trim() : "";
  }
  if (!role) role = FALLBACK.role;

  const summary = getText("#about .intro p") || FALLBACK.summary;
  const profileImage = getAttr("#about img.img-fluid", "src") || FALLBACK.photo;

  // Skills: try to get text from #skills .skill-item h4
  const skillNodes = document.querySelectorAll("#skills .skill-item h4");
  let skillsList = [];
  if (skillNodes && skillNodes.length>0) {
    skillNodes.forEach(s => skillsList.push(s.innerText.trim()));
  } else {
    // try to parse fallback technical array
    skillsList = FALLBACK.technical.slice();
  }

  // Experience / Education / Projects
  // We read raw innerHTML from the resume section if exists, else fallback
  const experienceHTML = getHTML("#resume .experience-section") || FALLBACK.experienceHTML;
  const educationHTML = getHTML("#resume .education-section") || FALLBACK.educationHTML;
  const projectsHTML = FALLBACK.projectsHTML; // available in fallback
  const languagesHTML = getHTML("#resume .education-section + .languages") || FALLBACK.languagesHTML;

  // contact: try to read from #about .signature-section or anywhere
  // fallback to PDF values
  const contactEmail = (getText("#about .contact-email") || FALLBACK.email);
  const contactPhone = (getText("#about .contact-phone") || FALLBACK.phone);
  const contactLocation = (getText("#about .contact-location") || FALLBACK.location);

  // Build the final HTML (matches PDF's visual layout closely)
  const cvHTML = `
  <div class="cv-print injected" dir="ltr" style="direction: ltr;">
    <div class="cv-header" style="direction: ltr;">
      <div class="cv-photo">${ profileImage ? `<img src="${profileImage}" alt="photo">` : '' }</div>
      <div class="cv-head-meta">
        <div class="cv-name">${name}</div>
        <div class="cv-role">${role}</div>
        <div class="cv-contact">
          <div>${contactLocation}</div>
          <div>📧 <a href="mailto:${contactEmail}">${contactEmail}</a></div>
          <div>📱 ${contactPhone}</div>
        </div>
      </div>
    </div>

    <div class="cv-body" style="direction: ltr;">
      <div class="col-left" style="direction: ltr;">
        <div class="box">
          <div class="box-title">Professional Summary</div>
          <div class="summary-text">${escapeHtml(summary)}</div>
        </div>

        <div class="box">
          <div class="box-title">Technical Skills</div>
          <div class="skills-grid">
            ${skillsList.map(s => `<div class="skill-badge">${escapeHtml(s)}</div>`).join('')}
          </div>
        </div>

        <div class="box">
          <div class="box-title">Languages</div>
          <div class="summary-text">${languagesHTML}</div>
        </div>
      </div>

      <div class="col-right" style="direction: ltr;">
        <div class="box">
          <div class="box-title">Professional Experience</div>
          <div class="cv-resume">
            ${experienceHTML}
          </div>
        </div>

        <div class="box">
          <div class="box-title">Personal Projects</div>
          <div class="cv-resume">
            ${projectsHTML}
          </div>
        </div>

        <div class="box">
          <div class="box-title">Education</div>
          <div class="cv-resume">
            ${educationHTML}
          </div>
        </div>
      </div>
    </div>

    <div class="cv-footer">Generated from website — ${new Date().toLocaleDateString()}</div>
  </div>
  `;

  // put into DOM hidden container (some browsers need element present)
  const out = document.getElementById("cv-output");
  out.innerHTML = cvHTML;
  out.style.display = "block";

  // PDF options tuned for A4 portrait, improved quality
  const opt = {
    margin:       [0.3, 0.35, 0.3, 0.35], // top, left, bottom, right (inches)
    filename:     `${name.replace(/\s+/g, '_')}_CV.pdf`,
    image:        { type: 'jpeg', quality: 1 },
    html2canvas:  { scale: 2, useCORS: true, logging: false },
    jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
  };

  // Generate PDF from the DOM node we just created
  const element = out.querySelector('.cv-print');
  html2pdf().set(opt).from(element).save().then(()=> {
    // hide the container again
    out.style.display = "none";
  }).catch(err => {
    console.error("PDF generation error:", err);
    alert("حدث خطأ أثناء توليد الـ PDF — افتح الكونسول للتفاصيل.");
    out.style.display = "none";
  });
});

/* small helper to avoid XSS when injecting text */
function escapeHtml(str) {
  if (!str) return '';
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;')
    .replace(/\n/g, '<br>');
}
</script>
</body>
</html>
